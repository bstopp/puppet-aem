#!/bin/sh

<%- runmodeopts = "" -%>

<%- @runmodes.each do |r| -%>
  <%- runmodeopts = @runmodeopts + "," + r -%>
<%- end -%>

<%- if @mongo -%>
  <%- runmodeopts = @runmodeopts + ",crx3,crx3mongo" -%>
<%- end -%>

<%- cmd = "java " -%>

<%- if !@jvm_opts.empty? -%>
  <% cmd = @cmd + " " + @jvm_opts -%>
<%- end -%>
  
<%- cmd = cmd + " -jar " + @jar -%>
  
<%- if !@port.empty? -%>
  <% cmd = cmd + " -p " + @port -%>
<%- end -%> 

<% cmd = cmd + " -nobrowser -b " + @aem_home + " -r " + @runmodeopts %> 

<%- if !@ll.empty? -%>
  <% cmd = @cmd + " -ll " + @log_level %>
<%- end -%>

<%- cmd = @cmd + " > /dev/null 2>&1 & " -%>

<%= @cmd %>